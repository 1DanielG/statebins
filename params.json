{"name":"statebins","tagline":"U.S. State Cartogram Heatmaps in R; an alternative to choropleths of US States ala http://bit.ly/statebins","body":"statebins is an alternative to choropleth maps for USA States\r\n\r\nThe following functions are implemented:\r\n\r\n-   `statebins` - creates \"statebin\" charts in the style of <http://bit.ly/statebins> - This version uses discrete `RColorBrewer` scales, binned by the \"breaks\" parameter.\r\n-   `statebins_continuous` - creates \"statebin\" charts in the style of <http://bit.ly/statebins> - This version uses a continuous scale based on `RColorBrewer` scales (passing in a 6 element `RColorBrewer` palette to `scale_fill_gradientn`).\r\n\r\n### TODO\r\n\r\n-   The current version is usable, but I think the plot margins and the legends need work\r\n-   Apply algorithm to switch to light-on-dark depending on the background tile color\r\n\r\n### News\r\n\r\n-   Version `1.0.0` released\r\n\r\n### Installation\r\n\r\n``` {.r}\r\ndevtools::install_github(\"hrbrmstr/statebins\")\r\n```\r\n\r\n### Usage\r\n\r\nAll of the following examples use the [WaPo data](http://www.washingtonpost.com/wp-srv/special/business/states-most-threatened-by-trade/states.csv?cache=1). It looks like the columns they use are scaled data and I didn't take the time to figure out what they did, so the final figure just mimics their output (including the non-annotated legend).\r\n\r\n``` {.r}\r\nlibrary(statebins)\r\n\r\n# current verison\r\npackageVersion(\"statebins\")\r\n```\r\n\r\n    ## [1] '1.0'\r\n\r\n``` {.r}\r\n# the original wapo data\r\n\r\ndat <- read.csv(\"http://www.washingtonpost.com/wp-srv/special/business/states-most-threatened-by-trade/states.csv?cache=1\", stringsAsFactors=FALSE)\r\n\r\ngg <- statebins(dat, \"state\", \"avgshare94_00\", breaks=4, \r\n                labels=c(\"0-1\", \"1-2\", \"2-3\", \"3-4\"),\r\n                legend_title=\"Share of workforce with jobs lost or threatened by trade\", font_size=3, \r\n                brewer_pal=\"Blues\", text_color=\"black\", \r\n                plot_title=\"1994-2000\", title_position=\"bottom\")\r\n\r\ngg\r\n```\r\n\r\n![plot of chunk unnamed-chunk-3](./README_files/figure-markdown_github/unnamed-chunk-31.png)\r\n\r\n``` {.r}\r\n# continuous scale, legend on top\r\n\r\ngg2 <- statebins_continuous(dat, \"state\", \"avgshare01_07\",\r\n                            legend_title=\"Share of workforce with jobs lost or threatened by trade\", legend_position=\"top\",\r\n                            brewer_pal=\"OrRd\", text_color=\"black\", font_size=3, \r\n                            plot_title=\"2001-2007\", title_position=\"bottom\")\r\n\r\ngg2\r\n```\r\n\r\n![plot of chunk unnamed-chunk-3](./README_files/figure-markdown_github/unnamed-chunk-32.png)\r\n\r\n``` {.r}\r\n# continuous scale, no legend\r\n\r\ngg3 <- statebins_continuous(dat, \"state\", \"avgshare08_12\",\r\n                            legend_title=\"States\", legend_position=\"none\",\r\n                            brewer_pal=\"Purples\", text_color=\"black\", font_size=3, \r\n                            plot_title=\"2008-2012\", title_position=\"bottom\")\r\n\r\ngg3\r\n```\r\n\r\n![plot of chunk unnamed-chunk-3](./README_files/figure-markdown_github/unnamed-chunk-33.png)\r\n\r\n``` {.r}\r\n# or, more like the one in the WaPo article; i might be picking the wrong columns here. it's just for an example\r\n\r\nsb <- function(col, title) {\r\n  statebins(dat, \"state\",col, brewer_pal=\"Blues\", text_color=\"black\", legend_position=\"none\", font_size=3, plot_title=title, breaks=4, labels=1:4)\r\n}\r\n```\r\n\r\n``` {.r}\r\n# cheating and using <table> to arrange them below and also making a WaPo-like legend, \r\n# since mucking with grid graphics margins/padding was not an option time-wise at the moment\r\n\r\nsb(\"avgshare94_00\", \"1994-2000\")\r\nsb(\"avgshare01_07\", \"2001-2007\")\r\nsb(\"avgshare08_12\", \"2008-2012\")\r\n```\r\n\r\n<!-- uncomment the following and add backticks where appropriate and remove the reference to -->\r\n<!-- the static image when the rmarkdown output is HTML and this will work fine. github does not render the markdown properly -->\r\n<!-- \r\n<span style=\"font-size:17px; color:#333;\">Share of workforce with jobs lost or threatened by trade</span><br/>\r\n\r\n<table style=\"width:200px\" cellpadding=0, cellspacing=0><tr style=\"line-height:10px\">\r\n<td width=\"25%\" style=\"background:#EFF3FF;\">&nbsp;</td>\r\n<td width=\"25%\" style=\"background:#BDD7E7;\">&nbsp;</td>\r\n<td width=\"25%\" style=\"background:#6BAED6;\">&nbsp;</td>\r\n<td width=\"25%\" style=\"background:#2171B5;\">&nbsp;</td></tr>\r\n<tr><td colspan=2 align=\"left\" style=\"font-size:14px\">Smallest share</td><td colspan=2 align=\"right\" style=\"font-size:14px\">Largest</td></tr>\r\n</table>\r\n\r\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n<tr><td width=\"50%\">\r\n\r\n{r f1994, echo=FALSE, fig.width=6, fig.height=5}\r\nsb(\"avgshare94_00\", \"1994-2000\")\r\n\r\n</td><td width=\"50%\">\r\n\r\n{r f2001, echo=FALSE, fig.width=6, fig.height=5, results='asis'}\r\nsb(\"avgshare01_07\", \"2001-2007\")\r\n\r\n</td></tr><tr><td width=\"50%\">\r\n\r\n{r f2008, echo=FALSE, fig.width=6, fig.height=5, results='asis'}\r\nsb(\"avgshare08_12\", \"2008-2012\")\r\n\r\n</td><td width=\"50%\"> &nbsp; </td></tr></table>\r\n\r\n-->\r\n\r\n<center>\r\n![img](./tmp/statebins-composite.png)\r\n</center>\r\n\r\nAnd, we'll throw in a gratuitous animation for good measure:\r\n\r\n``` {.r}\r\n# data set from StatsAmerica - http://www.statsamerica.org/profiles/sip_index.html\r\n\r\n# median household income from the ACS survey\r\nmiacs <- read.csv(\"http://dds.ec/data/median-income-acs.csv\", header=TRUE, stringsAsFactors=FALSE)\r\n\r\n# generate frames based on year\r\nsapply(unique(miacs$year), function(year) {\r\n  \r\n  png(file=sprintf(\"tmp/household%d.png\", year),\r\n      type=\"quartz\", antialias=\"subpixel\", width=800, height=600)\r\n  \r\n  rng <- floor(range(miacs[miacs$year==year,]$mh_inc))\r\n  \r\n  ggtmp <- statebins(miacs[miacs$year==year,], \"state\", \"mh_inc\",\r\n                   legend_title=\"States\", legend_position=\"none\",\r\n                   brewer_pal=\"Greens\", text_color=\"black\", font_size=3,\r\n                   plot_title=sprintf(\"Median Household Income (ACS) %d\\n$%s - $%s\", year, comma(rng[1]), comma(rng[2])), title_position=\"top\")\r\n  \r\n  print(ggtmp)\r\n  \r\n  dev.off()\r\n  \r\n})\r\n\r\n# animate them with ImageMagick\r\nsystem(\"convert -background white -alpha remove -layers OptimizePlus -delay 150 tmp/*.png -loop 1 tmp/household.gif\")\r\n```\r\n\r\n<center>\r\n![img](./tmp/household.gif)\r\n</embed></center>\r\n\r\n### Test Results\r\n\r\n``` {.r}\r\nlibrary(statebins)\r\nlibrary(testthat)\r\n\r\ndate()\r\n```\r\n\r\n    ## [1] \"Tue Aug 26 17:53:56 2014\"\r\n\r\n``` {.r}\r\ntest_dir(\"tests/\")\r\n```\r\n\r\n    ## basic functionality :\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}